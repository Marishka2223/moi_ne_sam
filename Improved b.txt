<?php
session_start();

// Подключение к базе данных
$mysqli = new mysqli("localhost", "root", "root", "modulez");

// Проверка соединения
if ($mysqli->connect_error) {
    die("Ошибка подключения: " . $mysqli->connect_error);
}

// Проверка, авторизован ли пользователь и является ли он администратором
if (!isset($_SESSION['modulez']) || $_SESSION['modulez'] !== '1') {
    die("Доступ запрещен. Пользователь не авторизован или не имеет прав администратора.");
}
?>

<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Добавление категории</title>
</head>
<body>

<header style="display: flex; background-color: rgba(252, 149, 53, 0.82);color: white; align-items: center; flex-wrap: row; gap: 25px; padding: 20px; max-height: 30px; ">
    <a href="./ads.php" style="color: white; margin-left: 30%; font-size: 1.5em">Главная</a>

    <?php
    if (isset($_SESSION['modulez']) && $_SESSION['modulez'] === '1') {
        echo '<a href="./admin.php" style="color: white; font-size: 1.5em">Админ панель</a>';
        echo '<a href="./logo.php" style="color: white; font-size: 1.5em">Выйти</a>';
    } elseif (isset($_SESSION['modulez']) && $_SESSION['modulez'] != '1') {
        echo '<a href="./acc.php" style="color: white; font-size: 1.5em">Мой аккаунт</a>';
        echo '<a href="./logo.php" style="color: white; font-size: 1.5em">Выйти</a>';
    } else {
        echo '<a href="./vxod.php" style="color: white; font-size: 1.5em">Войти</a>';
    }
    ?>
</header>

<h1>Добавление категории</h1>
<form method="post" enctype="multipart/form-data">
    <label for="name">Название:</label>
    <input type="text" id="name" name="name" required><br><br>

    <input type="submit" value="Добавить категорию">
</form>
</body>
</html>

<?php 
// Обработка формы
if ($_SERVER['REQUEST_METHOD'] === 'POST' && isset($_POST['name'])) {
    $name = $_POST['name'];

    // Использование подготовленного выражения для защиты от SQL-инъекций
    $stmt = $mysqli->prepare("INSERT INTO category (name) VALUES (?)");
    $stmt->bind_param("s", $name);

    if ($stmt->execute()) {
        header("Location: admin.php");
        exit();
    } else {
        echo "Ошибка: " . $stmt->error;
    }

    $stmt->close();
}

$mysqli->close();
?>
